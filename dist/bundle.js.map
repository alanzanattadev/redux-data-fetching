{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 223762cd1a5a1752e1fd","webpack:///./lib/graphqlTypesConverters.js","webpack:///external {\"commonjs2\":\"graphql\",\"commonjs\":\"graphql\",\"amd\":\"graphql\"}","webpack:///external {\"commonjs2\":\"immutable\",\"commonjs\":\"immutable\",\"amd\":\"immutable\"}","webpack:///external {\"commonjs2\":\"normalizr\",\"commonjs\":\"normalizr\",\"amd\":\"normalizr\"}","webpack:///./lib/reducer.js","webpack:///./lib/utils.js","webpack:///./lib/index.js","webpack:///./lib/configurer.js","webpack:///./lib/middleware.js","webpack:///./lib/actions.js","webpack:///./lib/hoc.js","webpack:///external {\"root\":\"React\",\"commonjs2\":\"react\",\"commonjs\":\"react\",\"amd\":\"react\"}","webpack:///./lib/selectors.js"],"names":["isEntity","createEntitiesForTypes","getRecordSchemaForType","createRecordsForTypes","getDefinitionOfType","addDefinitionsForTypes","getConvertersFromSchema","getDataFromResponse","graphQLizr","graphQLRecordr","convertsEntityToRecord","convertsNormalizedEntitiesToRecords","convertsGraphQLResultToRootEntitiesIDs","convertsGraphQLQueryResultToRecords","convertsGraphQLResultToRecords","isGraphQLIntegratedType","typeName","includes","graphQLType","markers","Object","keys","getFields","reduce","red","fieldName","typesMap","assign","Entity","type","undefined","entities","fields","field","name","definition","length","ofType","forEach","define","schema","getQueryType","entityType","converters","data","key","Array","isArray","_typeMap","getTypeMap","records","entity","graphQLSchema","recordsTypes","console","error","Error","map","v","reduction","entityId","result","set","filter","id","associatedQuery","recordTypes","rootQuery","queries","convertedField","configureReducer","QUERY_PROGRESS_NOT_STARTED","QUERY_PROGRESS_PENDING","QUERY_PROGRESS_SUCCEED","QUERY_PROGRESS_FAILED","ResultsRecord","byQuery","byEntity","QueryRecord","results","progress","DataReducerRecord","normalizrTypes","warnBadIDRequest","supposedId","warn","getID","toString","reducer","state","action","normalizrModel","payload","normalized","JSON","parse","stringify","update","mergeDeepWith","a","b","query","request","hash","response","raw","value","deleteIn","hashString","str","i","char","charCodeAt","configure","context","__debug","graphQLCompiledSchema","selectorSchema","recordsModel","actions","middleware","GraphQLConnecter","typesSchema","graphql","ql","store","dispatch","queryStarted","dependencies","then","errors","packageData","queryFailed","next","configureActions","removeData","identifiers","configureConnecter","reducerName","mapPropsToNeeds","mapCacheToProps","shouldRefetch","queryProgressPropName","WrappedComponent","props","selectedData","getNeeds","selectData","nextProps","entityName","getReducer","getIn","entityOfTypeAndIDHasChanged","queryResults","queryName","associatedQueryType","isList","entitiesOfTypeHasChangedForQuery","currentReducer","nextReducer","currentNeeds","nextNeeds","nextQuery","currentQuery","dataForQueryHasChanged","mustReselectData","prevProps","warnAgainstEmptyQuery","log","Date","now","db","queryHash","convertedData","reducerChanged","setState","needs","queryProgress","Component","convertsFieldToSelectorField","convertsTypeToSelectorType","convertsTypeMapToSelectorTypeMap","convertsRootQueryToSelectorRootQuery","convertsTypesSchemaToSelectorSchema","getResolveQuery","resolveQuery","parent","args","rootValue","returnType","path","queryResult","getEntityTypeNameFromSelectorTypeName","getResolveEntity","resolveEntity","fieldValue","getSelectorTypeName","substring","getSelectorTypeFromType","convertsArgsArrayToArgsMap","arg","resolver","description","resolve","typeMap","selectorName","newTypeMap","startsWith","selectorTypeMap","selectorTypesMap","typesQuery","selectorTypesQuery"],"mappings":"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","file":"bundle.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"graphql\"), require(\"immutable\"), require(\"normalizr\"), require(\"react\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"graphql\", \"immutable\", \"normalizr\", \"react\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ReduxDataFetching\"] = factory(require(\"graphql\"), require(\"immutable\"), require(\"normalizr\"), require(\"react\"));\n\telse\n\t\troot[\"ReduxDataFetching\"] = factory(root[undefined], root[undefined], root[undefined], root[\"React\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_11__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 223762cd1a5a1752e1fd","\"use babel\";\r\n// @flow\r\n\r\nimport { schema } from \"normalizr\";\r\nimport {\r\n  printSchema,\r\n  graphql,\r\n  GraphQLObjectType,\r\n  GraphQLSchema,\r\n  GraphQLString,\r\n  GraphQLFloat,\r\n  GraphQLList,\r\n  GraphQLInt,\r\n  GraphQLBoolean,\r\n  GraphQLID,\r\n  GraphQLEnumType,\r\n  getNullableType,\r\n  getNamedType,\r\n} from \"graphql\";\r\nimport type {\r\n  GraphQLSchema as GraphQLSchemaType,\r\n  GraphQLNamedType,\r\n  GraphQLType,\r\n  GraphQLOutputType,\r\n  GraphQLField,\r\n} from \"graphql\";\r\nimport { Record, Map, List } from \"immutable\";\r\nimport type { Record as RecordType } from \"immutable\";\r\n\r\ntype RecordTypes = { [typeName: string]: RecordType<*> };\r\n\r\nfunction isGraphQLIntegratedType(typeName: string): boolean {\r\n  return [\r\n    \"String\",\r\n    \"Boolean\",\r\n    \"Int\",\r\n    \"ID\",\r\n    \"Float\",\r\n    \"__Schema\",\r\n    \"__Type\",\r\n    \"__TypeKind\",\r\n    \"__Field\",\r\n    \"__InputValue\",\r\n    \"__EnumValue\",\r\n    \"__Directive\",\r\n    \"__DirectiveLocation\",\r\n  ].includes(typeName);\r\n}\r\n\r\nexport function isEntity(\r\n  graphQLType: GraphQLNamedType,\r\n  markers: Array<string> = [\"id\"],\r\n): boolean {\r\n  return (\r\n    graphQLType instanceof GraphQLObjectType &&\r\n    Object.keys(graphQLType.getFields()).reduce(\r\n      (red, fieldName) => red || markers.includes(fieldName),\r\n      false,\r\n    )\r\n  );\r\n}\r\n\r\nexport function createEntitiesForTypes(\r\n  typesMap: { [typeName: string]: GraphQLNamedType },\r\n  markers: Array<string>,\r\n): { [typeName: string]: schema.Entity } {\r\n  return Object.keys(typesMap).reduce(\r\n    (red, typeName) =>\r\n      isGraphQLIntegratedType(typeName) ||\r\n      !isEntity(typesMap[typeName], markers)\r\n        ? red\r\n        : Object.assign(red, { [typeName]: new schema.Entity(typeName) }, {}),\r\n    {},\r\n  );\r\n}\r\n\r\nexport function getRecordSchemaForType(\r\n  type: GraphQLObjectType,\r\n): { [fieldName: string]: typeof undefined } {\r\n  return Object.keys(type.getFields()).reduce(\r\n    (red, fieldName) => Object.assign({}, red, { [fieldName]: undefined }),\r\n    {},\r\n  );\r\n}\r\n\r\nexport function createRecordsForTypes(typesMap: {\r\n  [typeName: string]: $FlowFixMe,\r\n}) {\r\n  return Object.keys(typesMap).reduce(\r\n    (red, typeName) =>\r\n      isGraphQLIntegratedType(typeName) ||\r\n      !(typesMap[typeName] instanceof GraphQLObjectType)\r\n        ? red\r\n        : Object.assign(red, {\r\n            [typeName]: Record(\r\n              getRecordSchemaForType(typesMap[typeName]),\r\n              typeName,\r\n            ),\r\n          }),\r\n    {},\r\n  );\r\n}\r\n\r\nexport function getDefinitionOfType(\r\n  graphQLType: GraphQLType,\r\n  entities: { [typeName: string]: schema.Entity },\r\n) {\r\n  if (graphQLType instanceof GraphQLObjectType) {\r\n    const fields = Object.keys(\r\n      graphQLType.getFields(),\r\n    ).reduce((red, fieldName) => {\r\n      // $FlowFixMe\r\n      const field = graphQLType.getFields()[fieldName];\r\n      // $FlowFixMe\r\n      if (field.type.name in entities)\r\n        return Object.assign({}, red, {\r\n          // $FlowFixMe\r\n          [fieldName]: entities[field.type.name],\r\n        });\r\n      else {\r\n        const definition = getDefinitionOfType(field.type, entities);\r\n        if (definition)\r\n          return Object.assign({}, red, { [fieldName]: definition });\r\n        else return red;\r\n      }\r\n    }, {});\r\n    if (Object.keys(fields).length > 0) return fields;\r\n    else return undefined;\r\n  } else if (graphQLType instanceof GraphQLList) {\r\n    if (graphQLType.ofType.name in entities)\r\n      return [entities[graphQLType.ofType.name]];\r\n    else return undefined;\r\n  } else {\r\n    return undefined;\r\n  }\r\n}\r\n\r\nexport function addDefinitionsForTypes(\r\n  typesMap: { [typeName: string]: GraphQLNamedType },\r\n  entities: { [typeName: string]: schema.Entity },\r\n): void {\r\n  Object.keys(typesMap).forEach(typeName => {\r\n    if (\r\n      isGraphQLIntegratedType(typeName) === false &&\r\n      entities[typeName] instanceof schema.Entity\r\n    ) {\r\n      const definition = getDefinitionOfType(typesMap[typeName], entities);\r\n      entities[typeName].define(definition || {});\r\n    }\r\n  });\r\n}\r\n\r\nexport function getConvertersFromSchema(\r\n  schema: GraphQLSchemaType,\r\n): { [fieldName: string]: string } {\r\n  return Object.keys(schema.getQueryType().getFields()).reduce((red, field) => {\r\n    const type = schema.getQueryType().getFields()[field].type;\r\n    let entityType;\r\n    if (type instanceof GraphQLList) entityType = getNamedType(type).name;\r\n    else if (type instanceof GraphQLEnumType) entityType = type.name;\r\n    else entityType = getNamedType(type).name;\r\n    return Object.assign({}, red, { [field]: entityType });\r\n  }, {});\r\n}\r\n\r\nexport function getDataFromResponse(\r\n  converters: { [fieldName: string]: string },\r\n  data: Object,\r\n) {\r\n  return Object.keys(data).reduce((red, key) => {\r\n    return Object.assign({}, red, {\r\n      [converters[key]]: Array.isArray(data[key]) ? data[key] : [data[key]],\r\n    });\r\n  }, {});\r\n}\r\n\r\nexport function graphQLizr(\r\n  schema: GraphQLSchemaType,\r\n  { markers = [\"id\"] }: { markers: Array<string> } = {},\r\n): {\r\n  entities: { [typeName: string]: schema.Entity },\r\n  converters: { [fieldName: string]: string },\r\n} {\r\n  const entities = createEntitiesForTypes(schema._typeMap, markers);\r\n  const converters = getConvertersFromSchema(schema);\r\n  addDefinitionsForTypes(schema.getTypeMap(), entities);\r\n  return { entities, converters };\r\n}\r\n\r\nexport function graphQLRecordr(schema: GraphQLSchemaType) {\r\n  const records = createRecordsForTypes(schema.getTypeMap());\r\n  return records;\r\n}\r\n\r\nexport function convertsEntityToRecord(\r\n  entity?: ?Object | mixed,\r\n  type: string,\r\n  graphQLSchema: GraphQLSchemaType,\r\n  recordsTypes: RecordTypes,\r\n): RecordType<*> | mixed {\r\n  if (typeof entity !== \"object\" || entity == null) return entity;\r\n  if (Array.isArray(entity) === true) {\r\n    console.error(\"Trying to convert\", entity, \"into a Record of type\", type);\r\n    throw new Error(\r\n      \"ILS is trying to convert an Array in a Record which is impossible, you may have called packageData with wrong types (Array instead of Object) or something wrong with the normalization\",\r\n    );\r\n  }\r\n  // $FlowFixMe\r\n  return new recordsTypes[type](\r\n    Object.keys(entity).reduce((red, key) => {\r\n      // $FlowFixMe\r\n      const field = entity[key];\r\n      if (\r\n        typeof field == \"object\" &&\r\n        Array.isArray(field) == false &&\r\n        field != null\r\n      ) {\r\n        if (\r\n          graphQLSchema.getTypeMap()[type] == null ||\r\n          !(graphQLSchema.getTypeMap()[type] instanceof GraphQLObjectType) ||\r\n          // $FlowFixMe\r\n          graphQLSchema.getTypeMap()[type].getFields()[key] == null\r\n        ) {\r\n          console.error(\r\n            \"Error trying to convert entity\",\r\n            entity,\r\n            \"to record of type\",\r\n            type,\r\n          );\r\n          throw new Error(\r\n            `Error has been detected when trying to access the field with key ${key}, if key is a number you may have wrapped data, sent to packageData, in an array where you shouldn't`,\r\n          );\r\n        }\r\n        return Object.assign({}, red, {\r\n          [key]: convertsEntityToRecord(\r\n            field,\r\n            // $FlowFixMe\r\n            graphQLSchema.getTypeMap()[type].getFields()[key].type.name,\r\n            graphQLSchema,\r\n            recordsTypes,\r\n          ),\r\n        });\r\n      } else if (typeof field == \"object\" && Array.isArray(field) === true) {\r\n        return Object.assign({}, red, {\r\n          [key]: field.map(\r\n            v =>\r\n              typeof v === \"object\"\r\n                ? convertsEntityToRecord(\r\n                    v,\r\n                    // $FlowFixMe\r\n                    graphQLSchema.getTypeMap()[type].getFields()[key].type\r\n                      .ofType.name,\r\n                    graphQLSchema,\r\n                    recordsTypes,\r\n                  )\r\n                : v,\r\n          ),\r\n        });\r\n      } else {\r\n        return Object.assign({}, red, { [key]: field });\r\n      }\r\n    }, {}),\r\n  );\r\n}\r\n\r\nexport function convertsNormalizedEntitiesToRecords(\r\n  entities: { [typeName: string]: { [id: string]: Object } },\r\n  recordsTypes: RecordTypes,\r\n  graphQLSchema: GraphQLSchemaType,\r\n): { [typeName: string]: { [id: string]: RecordType<*> } } {\r\n  return Object.keys(entities).reduce((red, typeName) => {\r\n    return Object.assign({}, red, {\r\n      [typeName]: Object.keys(\r\n        entities[typeName],\r\n      ).reduce((reduction, entityId) => {\r\n        return Object.assign({}, reduction, {\r\n          [entityId]: convertsEntityToRecord(\r\n            entities[typeName][entityId],\r\n            typeName,\r\n            graphQLSchema,\r\n            recordsTypes,\r\n          ),\r\n        });\r\n      }, {}),\r\n    });\r\n  }, {});\r\n}\r\n\r\nexport function convertsGraphQLResultToRootEntitiesIDs(\r\n  result: Object,\r\n): { [entityName: string]: Array<string | number> | string | number } {\r\n  return Object.keys(result).reduce((red, key) => {\r\n    if (!Array.isArray(result[key]) && result[key] == null) return red;\r\n    return red.set(\r\n      key,\r\n      Array.isArray(result[key])\r\n        ? result[key].filter(entity => entity != null).map(entity => entity.id)\r\n        : result[key].id,\r\n    );\r\n  }, Map());\r\n}\r\n\r\nexport function convertsGraphQLQueryResultToRecords(\r\n  result: mixed,\r\n  associatedQuery: GraphQLField<any, any>,\r\n  schema: GraphQLSchema,\r\n  recordTypes: RecordTypes,\r\n) {\r\n  if (Array.isArray(result))\r\n    return List(result).map(v =>\r\n      convertsGraphQLQueryResultToRecords(\r\n        v,\r\n        associatedQuery,\r\n        schema,\r\n        recordTypes,\r\n      ),\r\n    );\r\n  else if (typeof result === \"object\" && result !== null) {\r\n    return convertsEntityToRecord(\r\n      result,\r\n      getNamedType(associatedQuery.type).name,\r\n      schema,\r\n      recordTypes,\r\n    );\r\n  } else {\r\n    return result;\r\n  }\r\n}\r\n\r\nexport function convertsGraphQLResultToRecords(\r\n  result: Object,\r\n  schema: GraphQLSchema,\r\n  recordTypes: RecordTypes,\r\n): Object {\r\n  const rootQuery = schema.getQueryType();\r\n  const queries = rootQuery.getFields();\r\n  return Object.keys(result).reduce((red, key) => {\r\n    const field = result[key];\r\n    const associatedQuery = queries[key];\r\n    const convertedField = convertsGraphQLQueryResultToRecords(\r\n      field,\r\n      associatedQuery,\r\n      schema,\r\n      recordTypes,\r\n    );\r\n    return {\r\n      ...red,\r\n      [key]: convertedField,\r\n    };\r\n  }, {});\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib/graphqlTypesConverters.js","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs2\":\"graphql\",\"commonjs\":\"graphql\",\"amd\":\"graphql\"}\n// module id = 1\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs2\":\"immutable\",\"commonjs\":\"immutable\",\"amd\":\"immutable\"}\n// module id = 2\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_3__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs2\":\"normalizr\",\"commonjs\":\"normalizr\",\"amd\":\"normalizr\"}\n// module id = 3\n// module chunks = 0","\"use babel\";\r\n// @flow\r\n\r\nimport { fromJS, Map, List, Set, Record } from \"immutable\";\r\nimport { normalize, schema } from \"normalizr\";\r\nimport {\r\n  graphQLizr,\r\n  convertsNormalizedEntitiesToRecords,\r\n  convertsGraphQLResultToRootEntitiesIDs,\r\n} from \"./graphqlTypesConverters\";\r\nimport type { GraphQLSchema as GraphQLSchemaType } from \"graphql\";\r\n\r\nexport const QUERY_PROGRESS_NOT_STARTED = \"not started\";\r\nexport const QUERY_PROGRESS_PENDING = \"pending\";\r\nexport const QUERY_PROGRESS_SUCCEED = \"succeed\";\r\nexport const QUERY_PROGRESS_FAILED = \"failed\";\r\n\r\nexport const ResultsRecord = Record({ byQuery: Map(), byEntity: Map() });\r\nexport const QueryRecord = Record({\r\n  results: new ResultsRecord(),\r\n  progress: QUERY_PROGRESS_NOT_STARTED,\r\n});\r\nexport const DataReducerRecord = Record({\r\n  entities: Map(),\r\n  queries: Map(),\r\n});\r\n\r\nexport default function configureReducer(\r\n  normalizrTypes: { [typeName: string]: schema.Entity },\r\n  recordsTypes: { [typeName: string]: Record<*> },\r\n  graphQLSchema: GraphQLSchemaType,\r\n) {\r\n  function warnBadIDRequest(type: string, supposedId: mixed): void {\r\n    console.warn(\r\n      \"You're trying to delete a key of bad type for type\",\r\n      type,\r\n      \":\",\r\n      supposedId,\r\n      \".Keys must be of type number, string or identified object eg: {id: 'key'}. Aborting request\",\r\n    );\r\n  }\r\n\r\n  function getID(data: string | number | { id: string }): ?string {\r\n    if (typeof data === \"string\") return data;\r\n    else if (typeof data === \"number\") return data.toString();\r\n    else if (typeof data === \"object\" && data !== null) {\r\n      return getID(data.id);\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  return function reducer(\r\n    state: DataReducerRecord = new DataReducerRecord(),\r\n    action: { type: string, payload: Object },\r\n  ) {\r\n    switch (action.type) {\r\n      case \"DATA_RECEIVED\":\r\n        const normalizrModel = Object.keys(\r\n          action.payload.entities,\r\n        ).reduce((red, key) => {\r\n          const type = normalizrTypes[key];\r\n          if (type === undefined)\r\n            throw new Error(\r\n              \"You can't normalize a type which is not an Entity. An Entity is a type with an id attribut. You may have defined a GraphQL root query type with a route that has a type without any id.\",\r\n            );\r\n          return Object.assign({}, red, {\r\n            [key]:\r\n              typeof action.payload.entities[key] == \"object\" &&\r\n              Array.isArray(action.payload.entities[key])\r\n                ? [type]\r\n                : type,\r\n          });\r\n        }, {});\r\n        const normalized = normalize(\r\n          JSON.parse(JSON.stringify(action.payload.entities)),\r\n          normalizrModel,\r\n        );\r\n        return state\r\n          .update(\"entities\", entities =>\r\n            entities.mergeDeepWith(\r\n              (a, b) => (b === undefined ? a : b),\r\n              convertsNormalizedEntitiesToRecords(\r\n                normalized.entities,\r\n                recordsTypes,\r\n                graphQLSchema,\r\n              ),\r\n            ),\r\n          )\r\n          .update(\r\n            \"queries\",\r\n            queries =>\r\n              action.payload.query\r\n                ? queries.set(\r\n                    action.payload.query.request.hash,\r\n                    new QueryRecord({\r\n                      results: new ResultsRecord({\r\n                        byQuery: convertsGraphQLResultToRootEntitiesIDs(\r\n                          action.payload.query.response.raw,\r\n                        ),\r\n                      }),\r\n                      progress: QUERY_PROGRESS_SUCCEED,\r\n                    }),\r\n                  )\r\n                : queries,\r\n          );\r\n      case \"DATA_REMOVED\":\r\n        return Object.keys(action.payload).reduce((red, key: string) => {\r\n          if (\r\n            typeof action.payload[key] == \"object\" &&\r\n            Array.isArray(action.payload[key])\r\n          ) {\r\n            return action.payload[key].reduce((reduction, value) => {\r\n              const id = getID(value);\r\n              if (id == null) {\r\n                warnBadIDRequest(key, value);\r\n                return reduction;\r\n              } else {\r\n                return reduction.deleteIn([\"entities\", key, id]);\r\n              }\r\n            }, red);\r\n          } else {\r\n            const id = getID(action.payload[key]);\r\n            if (id == null) {\r\n              warnBadIDRequest(key, action.payload[key]);\r\n              return red;\r\n            } else {\r\n              // $FlowFixMe\r\n              return red.deleteIn([\"entities\", key, id]);\r\n            }\r\n          }\r\n        }, state);\r\n      case \"QUERY_STARTED\":\r\n        return state.update(\"queries\", queries =>\r\n          queries.update(\r\n            action.payload.query.request.hash,\r\n            (query = new QueryRecord()) =>\r\n              query.set(\"progress\", QUERY_PROGRESS_PENDING),\r\n          ),\r\n        );\r\n      case \"QUERY_FAILED\":\r\n        return state.update(\"queries\", queries =>\r\n          queries.update(action.payload.query.request.hash, query =>\r\n            query.set(\"progress\", QUERY_PROGRESS_FAILED),\r\n          ),\r\n        );\r\n      default:\r\n        return state;\r\n    }\r\n  };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib/reducer.js","// @flow\n\nexport function hashString(str: string): number {\n  let hash = 0;\n  if (str.length == 0) return hash;\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = (hash << 5) - hash + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  return hash;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/utils.js","// @flow\r\n\r\nexport { configure } from \"./configurer\";\r\nexport {\r\n  QUERY_PROGRESS_NOT_STARTED,\r\n  QUERY_PROGRESS_PENDING,\r\n  QUERY_PROGRESS_SUCCEED,\r\n  QUERY_PROGRESS_FAILED,\r\n} from \"./reducer\";\r\nexport { graphQLizr, graphQLRecordr } from \"./graphqlTypesConverters\";\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib/index.js","\"use babel\";\n// @flow\nimport { schema } from \"normalizr\";\nimport { buildSchema } from \"graphql\";\nimport type { GraphQLSchema } from \"graphql\";\nimport configureMiddleware from \"./middleware\";\nimport configureReducer from \"./reducer\";\nimport configureActions from \"./actions\";\nimport configureConnecter from \"./hoc\";\nimport { graphQLizr, graphQLRecordr } from \"./graphqlTypesConverters\";\nimport { convertsTypesSchemaToSelectorSchema } from \"./selectors\";\n\nexport function configure(\n  graphQLSchema: GraphQLSchema | string,\n  context: mixed,\n  { __debug = false }: { __debug?: boolean } = {},\n) {\n  const graphQLCompiledSchema =\n    typeof graphQLSchema === \"string\"\n      ? buildSchema(graphQLSchema)\n      : graphQLSchema;\n  const selectorSchema = convertsTypesSchemaToSelectorSchema(\n    graphQLCompiledSchema,\n    { __debug },\n  );\n  const normalizrModel = graphQLizr(graphQLCompiledSchema);\n  const recordsModel = graphQLRecordr(graphQLCompiledSchema);\n  const actions = configureActions();\n  const middleware = configureMiddleware(\n    graphQLCompiledSchema,\n    actions,\n    normalizrModel,\n    context,\n  );\n  const reducer = configureReducer(\n    normalizrModel.entities,\n    recordsModel,\n    graphQLCompiledSchema,\n  );\n  const GraphQLConnecter = configureConnecter({\n    selectorSchema,\n    typesSchema: graphQLCompiledSchema,\n    recordTypes: recordsModel,\n  });\n  return {\n    actions,\n    middleware,\n    reducer,\n    normalizrModel,\n    recordsModel,\n    selectorSchema,\n    GraphQLConnecter,\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/configurer.js","import { hashString } from \"./utils\";\nimport { graphql } from \"graphql\";\nimport { getDataFromResponse } from \"./graphqlTypesConverters\";\n\nexport default function(schema, actions, normalizrModel, context) {\n  return store => next => action => {\n    if (action.graphql) {\n      const hash = hashString(action.payload);\n      const request = {\n        ql: action.payload,\n        hash,\n      };\n      store.dispatch(actions.queryStarted({ request }));\n      graphql(schema, action.payload, undefined, {\n        store,\n        dependencies: context,\n      }).then(result => {\n        if (result.errors === undefined) {\n          store.dispatch(\n            actions.packageData(\n              getDataFromResponse(normalizrModel.converters, result.data),\n              {\n                request,\n                response: {\n                  raw: result.data,\n                },\n              },\n            ),\n          );\n        } else {\n          console.error(\n            \"GraphQL query\",\n            action.payload,\n            \"has failed.\\n\",\n            \"errors:\",\n            result.errors,\n          );\n          store.dispatch(actions.queryFailed({ request }, result.errors));\n        }\n      });\n    } else {\n      return next(action);\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/middleware.js","\"use babel\";\r\n// @flow\r\n\r\ntype QueryRequest = {\r\n  ql: string,\r\n  hash: string | number,\r\n};\r\n\r\ntype QueryDetails = {\r\n  request: QueryRequest,\r\n  response?: {\r\n    raw: Object,\r\n  },\r\n};\r\n\r\nexport default function configureActions() {\r\n  return {\r\n    packageData(data: Object, query?: QueryDetails) {\r\n      return {\r\n        type: \"DATA_RECEIVED\",\r\n        payload: {\r\n          entities: data,\r\n          query,\r\n        },\r\n      };\r\n    },\r\n    queryStarted(query: QueryDetails) {\r\n      return {\r\n        type: \"QUERY_STARTED\",\r\n        payload: {\r\n          query,\r\n        },\r\n      };\r\n    },\r\n    removeData(identifiers: {\r\n      [key: string]:\r\n        | number\r\n        | string\r\n        | { id: string | number }\r\n        | Array<number | string | { id: string | number }>,\r\n    }) {\r\n      return {\r\n        type: \"DATA_REMOVED\",\r\n        payload: identifiers,\r\n      };\r\n    },\r\n    queryFailed(query: QueryDetails, errors: Array<Object>) {\r\n      return {\r\n        type: \"QUERY_FAILED\",\r\n        payload: {\r\n          query,\r\n          errors,\r\n        },\r\n      };\r\n    },\r\n  };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./lib/actions.js","\"use babel\";\n// @flow\n\nimport React from \"react\";\nimport { graphql, GraphQLSchema, getNamedType } from \"graphql\";\nimport { fromJS, List } from \"immutable\";\nimport { convertsGraphQLResultToRecords } from \"./graphqlTypesConverters\";\nimport { hashString } from \"./utils\";\nimport { QUERY_PROGRESS_NOT_STARTED, QueryRecord } from \"./reducer\";\nimport type { Record } from \"immutable\";\n\ntype Props = Object;\n\ntype State = {\n  selectedData: ?Object,\n};\n\nexport default function configureConnecter(\n  {\n    typesSchema,\n    selectorSchema,\n    recordTypes,\n    reducerName = \"data\",\n  }: {\n    typesSchema: GraphQLSchema,\n    selectorSchema: GraphQLSchema,\n    recordTypes: { [typeName: string]: Record<any> },\n    reducerName?: string,\n  } = {},\n) {\n  if (typesSchema === undefined) {\n    throw new Error(\n      \"You have to define a type schema, type schema is currently \" +\n        typesSchema,\n    );\n  }\n  if (selectorSchema === undefined) {\n    throw new Error(\n      \"You have to define a selector schema, selector schema is currently \" +\n        selectorSchema,\n    );\n  }\n  return function GraphQLConnecter(\n    mapPropsToNeeds: (props: Props) => string,\n    mapCacheToProps: (\n      cache: any,\n      props: Props,\n      selectedData: Object,\n    ) => any = () => ({}),\n    shouldRefetch: (props: Props, prevProps: Props) => boolean = () => false,\n    {\n      queryProgressPropName = \"queryProgress\",\n    }: { queryProgressPropName?: string } = {},\n  ) {\n    return function(\n      WrappedComponent: Class<React.Component<any, any, any>>,\n    ): Class<React.Component<any, any, any>> {\n      return class GraphQLContainer extends React.Component<any, Props, any> {\n        props: Props;\n\n        constructor(props) {\n          super(props);\n\n          this.state = {\n            selectedData: {},\n          };\n        }\n\n        componentDidMount() {\n          this.getNeeds();\n          this.selectData(this.props);\n        }\n\n        getReducer(props) {\n          return props[reducerName];\n        }\n\n        entityOfTypeAndIDHasChanged(\n          props,\n          nextProps,\n          entityName: string,\n          id: string | number,\n        ) {\n          return (\n            this.getReducer(props).getIn([entityName, id]) !==\n            this.getReducer(nextProps).getIn([entityName, id])\n          );\n        }\n\n        entitiesOfTypeHasChangedForQuery(\n          props,\n          nextProps,\n          typeName: string,\n          results,\n        ) {\n          return results.reduce((red, id) => {\n            if (red === true) return true;\n            else {\n              return this.entityOfTypeAndIDHasChanged(\n                props,\n                nextProps,\n                typeName,\n                id,\n              );\n            }\n          }, false);\n        }\n\n        dataForQueryHasChanged(props, nextProps, query: QueryRecord) {\n          return query.results.byQuery.reduce(\n            (red, queryResults, queryName) => {\n              const associatedQueryType = typesSchema\n                .getQueryType()\n                .getFields()[queryName];\n              const entityName = getNamedType(associatedQueryType.type).name;\n              if (Array.isArray(queryResults) || List.isList(queryResults)) {\n                return this.entitiesOfTypeHasChangedForQuery(\n                  props,\n                  nextProps,\n                  entityName,\n                  queryResults,\n                );\n              } else {\n                return this.entityOfTypeAndIDHasChanged(\n                  props,\n                  nextProps,\n                  entityName,\n                  queryResults,\n                );\n              }\n            },\n          );\n        }\n\n        mustReselectData(props, nextProps) {\n          const currentReducer = this.getReducer(props);\n          const nextReducer = this.getReducer(nextProps);\n          const currentNeeds = mapPropsToNeeds(props);\n          const nextNeeds = mapPropsToNeeds(nextProps);\n          if (nextNeeds !== currentNeeds) return true;\n          const hash = currentNeeds != null ? hashString(currentNeeds) : null;\n          if (hash != null) {\n            const nextQuery = nextReducer.getIn([\"queries\", hash]);\n            const currentQuery = currentReducer.getIn([\"queries\", hash]);\n            if (nextQuery !== currentQuery) return true;\n            else if (nextReducer.entities !== currentReducer.entities) {\n              return this.dataForQueryHasChanged(props, nextProps, nextQuery);\n            } else {\n              return false;\n            }\n          } else {\n            return false;\n          }\n        }\n\n        componentWillReceiveProps(nextProps: Props) {\n          if (this.mustReselectData(this.props, nextProps)) {\n            this.selectData(nextProps);\n          }\n        }\n\n        componentDidUpdate(prevProps: Props) {\n          if (\n            mapPropsToNeeds(this.props) != mapPropsToNeeds(prevProps) ||\n            shouldRefetch(this.props, prevProps)\n          ) {\n            this.getNeeds();\n          }\n        }\n\n        warnAgainstEmptyQuery() {\n          console.warn(\n            \"You have defined as needs {}, which is a wrong graphql query. If you want to avoid fetching, return null instead\",\n          );\n        }\n\n        selectData(props: Object) {\n          const query = mapPropsToNeeds(props);\n          const reducer = this.getReducer(props);\n          if (query === \"{}\" || query === \"{ }\") {\n            this.warnAgainstEmptyQuery();\n          } else if (query != null) {\n            const hash = hashString(query);\n            if (props.__debug) {\n              console.log(\n                \"SELECTING data for hash\",\n                hash,\n                \" -- date:\",\n                Date.now(),\n              );\n            }\n            graphql(selectorSchema, query, null, {\n              db: reducer,\n              queryHash: hash,\n            }).then(result => {\n              if (result.errors !== undefined || result.data == null) {\n                console.error(\n                  \"GraphQLConnecter: Impossible to select data. needs:\",\n                  query,\n                  \"errors:\",\n                  result.errors,\n                );\n              } else {\n                if (props.__debug) {\n                  console.log(\n                    \"SELECTED data\",\n                    result.data,\n                    \"for hash\",\n                    hash,\n                    \"with reducer\",\n                    reducer,\n                    \" -- date:\",\n                    Date.now(),\n                  );\n                }\n                const convertedData = convertsGraphQLResultToRecords(\n                  result.data,\n                  typesSchema,\n                  recordTypes,\n                );\n                const reducerChanged = this.getReducer(props) !== reducer;\n                if (props.__debug) {\n                  console.log(\n                    \"CONVERTED data\",\n                    result.data,\n                    \"into\",\n                    convertedData,\n                    \"for hash\",\n                    \"with reducer\",\n                    reducer,\n                    reducerChanged ? \"but reducer has changed to\" : \"\",\n                    reducerChanged ? this.getReducer(props) : \"\",\n                    reducerChanged ? \"relaunching selection\" : \"\",\n                  );\n                }\n                if (reducerChanged) {\n                  this.selectData(props);\n                } else {\n                  this.setState(state => ({ selectedData: convertedData }));\n                }\n              }\n            });\n          }\n        }\n\n        getNeeds() {\n          const needs = mapPropsToNeeds(this.props);\n          if (needs === \"{}\" || needs === \"{ }\") {\n            this.warnAgainstEmptyQuery();\n          } else if (needs != null) {\n            this.props.dispatch({\n              type: \"GRAPHQL_FETCH\",\n              graphql: true,\n              payload: needs,\n            });\n          }\n        }\n\n        render() {\n          const reducer = this.getReducer(this.props);\n          if (!reducer)\n            throw new Error(\n              `GraphQLConnecter must get the cache reducer as a props named '${reducerName}'`,\n            );\n          if (!this.props.dispatch)\n            throw new Error(\n              \"GraphQLConnecter must get the dispatch function as props\",\n            );\n          const needs = mapPropsToNeeds(this.props);\n          const queryProgress =\n            needs !== null\n              ? reducer.getIn(\n                  [\"queries\", hashString(needs), \"progress\"],\n                  QUERY_PROGRESS_NOT_STARTED,\n                )\n              : QUERY_PROGRESS_NOT_STARTED;\n          return (\n            <WrappedComponent\n              {...this.props}\n              {...this.state.selectedData}\n              {...mapCacheToProps(\n                this.props.data,\n                this.props,\n                this.state.selectedData,\n              )}\n              {...{\n                [queryProgressPropName]: queryProgress,\n              }}\n              refetch={() => this.getNeeds()}\n            />\n          );\n        }\n      };\n    };\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/hoc.js","module.exports = __WEBPACK_EXTERNAL_MODULE_11__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"root\":\"React\",\"commonjs2\":\"react\",\"commonjs\":\"react\",\"amd\":\"react\"}\n// module id = 11\n// module chunks = 0","// @flow\n\nimport type {\n  GraphQLOutputType,\n  GraphQLType,\n  GraphQLField,\n  GraphQLNamedType,\n  GraphQLArgument,\n  GraphQLArgumentConfig,\n  GraphQLFieldConfigMap,\n  GraphQLFieldConfig,\n  GraphQLResolveInfo,\n} from \"graphql\";\nimport { Map } from \"immutable\";\nimport {\n  printSchema,\n  graphql,\n  GraphQLObjectType,\n  GraphQLSchema,\n  GraphQLString,\n  GraphQLFloat,\n  GraphQLList,\n  GraphQLInt,\n  GraphQLBoolean,\n  GraphQLID,\n  GraphQLEnumType,\n  GraphQLUnionType,\n  getNamedType,\n} from \"graphql\";\nimport { isEntity } from \"./graphqlTypesConverters\";\n\ntype TypeMap = { [typeName: string]: GraphQLNamedType };\n\nfunction getResolveQuery(entityName: string) {\n  return function resolveQuery(\n    parent,\n    args,\n    context,\n    { rootValue, fieldName, returnType, path }: GraphQLResolveInfo,\n  ) {\n    if (context == null || context.db == null || context.queryHash == null)\n      throw new Error(\n        \"You have to pass database (entities and results) as db and graphql query as queryHash in contextValue\",\n      );\n    const queryResult = context.db.getIn([\n      \"queries\",\n      context.queryHash,\n      \"results\",\n      \"byQuery\",\n      path !== undefined ? path.key : fieldName,\n    ]);\n    if (queryResult == null) {\n      if (returnType instanceof GraphQLList) return [];\n      else return null;\n    }\n    if (returnType instanceof GraphQLList) {\n      const typeName = getEntityTypeNameFromSelectorTypeName(\n        getNamedType(returnType.ofType).name,\n      );\n      return queryResult.map(id =>\n        context.db.getIn([\"entities\", typeName, id.toString()]),\n      );\n    } else if (queryResult != null) {\n      return context.db.getIn([\n        \"entities\",\n        getEntityTypeNameFromSelectorTypeName(getNamedType(returnType).name),\n        queryResult.toString(),\n      ]);\n    } else {\n      return null;\n    }\n  };\n}\n\nfunction getResolveEntity(entityName: string) {\n  return function resolveEntity(\n    parent,\n    args,\n    context,\n    { rootValue, fieldName, returnType }: GraphQLResolveInfo = {},\n  ) {\n    const fieldValue = parent[fieldName];\n    if (returnType instanceof GraphQLList && fieldValue != null) {\n      return fieldValue.map(id =>\n        context.db.getIn([\"entities\", entityName, id.toString()]),\n      );\n    } else if (fieldValue != null) {\n      return context.db.getIn([\"entities\", entityName, fieldValue.toString()]);\n    } else {\n      return null;\n    }\n  };\n}\n\nfunction getSelectorTypeName(name: string): string {\n  return `${name}Selector`;\n}\n\nfunction getEntityTypeNameFromSelectorTypeName(name: string): string {\n  return name.substring(0, name.length - 8);\n}\n\nfunction getSelectorTypeFromType(\n  type: GraphQLOutputType,\n  typesMap: TypeMap,\n): GraphQLOutputType {\n  if (type instanceof GraphQLList)\n    return new GraphQLList(getSelectorTypeFromType(type.ofType, typesMap));\n  else if (type instanceof GraphQLObjectType) {\n    const typeName = getSelectorTypeName(getNamedType(type).name);\n    if (typesMap[typeName] == null) {\n      throw new Error(\n        \"Something went wrong in schema conversions. Trying to access \" +\n          typeName +\n          \" type is impossible in Selectors Schema TypeMap\",\n      );\n    }\n    // $FlowFixMe\n    return typesMap[typeName];\n  } else {\n    return type;\n  }\n}\n\nfunction convertsArgsArrayToArgsMap(\n  args: Array<GraphQLArgument>,\n): { [argName: string]: GraphQLArgumentConfig } {\n  return args.reduce(\n    (red, arg): { [argName: string]: GraphQLArgumentConfig } => ({\n      ...red,\n      [arg.name]: arg,\n    }),\n    {},\n  );\n}\n\nexport function convertsFieldToSelectorField(\n  query: GraphQLField<any, any>,\n  typesMap: TypeMap,\n  type: \"entity\" | \"query\" | \"scalar\",\n): GraphQLFieldConfig<any, any> {\n  let resolver;\n  let name: string;\n  switch (type) {\n    case \"entity\":\n      name = getSelectorTypeName(query.name);\n      resolver = getResolveEntity(getNamedType(query.type).name);\n      break;\n    case \"query\":\n      name = getSelectorTypeName(query.name);\n      resolver = getResolveQuery(getNamedType(query.type).name);\n      break;\n    default:\n      name = query.name;\n  }\n  return {\n    description: query.description,\n    args: convertsArgsArrayToArgsMap(query.args),\n    type: getSelectorTypeFromType(query.type, typesMap),\n    resolve: resolver,\n  };\n}\n\nexport function convertsTypeToSelectorType(\n  type: GraphQLObjectType,\n  typeMap: TypeMap,\n): GraphQLOutputType {\n  const selectorName = getSelectorTypeName(type.name);\n  return new GraphQLObjectType({\n    name: selectorName,\n    fields: () =>\n      Object.keys(type.getFields()).reduce((red, key) => {\n        return {\n          ...red,\n          [key]: isEntity(getNamedType(type.getFields()[key].type))\n            ? convertsFieldToSelectorField(\n                type.getFields()[key],\n                typeMap,\n                \"entity\",\n              )\n            : convertsFieldToSelectorField(\n                type.getFields()[key],\n                typeMap,\n                \"scalar\",\n              ),\n        };\n      }, {}),\n  });\n}\n\nexport function convertsTypeMapToSelectorTypeMap(typeMap: TypeMap): TypeMap {\n  let newTypeMap = {};\n  Object.keys(typeMap).forEach(key => {\n    const type = typeMap[key];\n    if (\n      /*isEntity(type) === true &&*/ type instanceof GraphQLObjectType &&\n      !key.startsWith(\"__\")\n    ) {\n      newTypeMap[getSelectorTypeName(key)] = convertsTypeToSelectorType(\n        type,\n        newTypeMap,\n      );\n    } else {\n      newTypeMap[key] = type;\n    }\n  });\n  return newTypeMap;\n}\n\nexport function convertsRootQueryToSelectorRootQuery(\n  rootQuery: GraphQLObjectType,\n  selectorTypeMap: TypeMap,\n): GraphQLObjectType {\n  return new GraphQLObjectType({\n    name: \"SelectorsRootQueryType\",\n    fields: Object.keys(rootQuery.getFields()).reduce((red, key) => {\n      return {\n        ...red,\n        [key]: convertsFieldToSelectorField(\n          rootQuery.getFields()[key],\n          selectorTypeMap,\n          \"query\",\n        ),\n      };\n    }, {}),\n  });\n}\n\nexport function convertsTypesSchemaToSelectorSchema(\n  schema: GraphQLSchema,\n  {\n    markers = [\"id\"],\n    __debug = false,\n  }: { markers?: Array<string>, __debug?: boolean } = {},\n): GraphQLSchema {\n  const typesMap = schema.getTypeMap();\n  const selectorTypesMap = convertsTypeMapToSelectorTypeMap(typesMap);\n  if (__debug) {\n    console.log(\n      \"DataModel TypeMap:\",\n      typesMap,\n      \"\\nSelector TypeMap:\",\n      selectorTypesMap,\n    );\n  }\n  const typesQuery = schema.getQueryType();\n  const selectorTypesQuery = convertsRootQueryToSelectorRootQuery(\n    typesQuery,\n    selectorTypesMap,\n  );\n  const selectorSchema = new GraphQLSchema({\n    query: selectorTypesQuery,\n  });\n  return selectorSchema;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lib/selectors.js"],"sourceRoot":""}